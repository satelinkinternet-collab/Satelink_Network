<%- include('partials/header', { activePage: 'overview' }) %>

<div class="mb-8 flex justify-between items-center">
    <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-1">Admin Overview</h1>
        <p class="text-sm text-satelink-muted">Platform health and real-time performance metrics</p>
    </div>
    <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-bold bg-emerald-50 text-emerald-700 border border-emerald-200">
        <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2 animate-pulse"></span>
        Live
    </span>
</div>

<!-- KPI Cards Row -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <div class="bg-white rounded-2xl border border-satelink-border shadow-sm p-5">
        <div class="text-xs font-semibold text-satelink-muted uppercase tracking-wider mb-2">Revenue Today</div>
        <div class="text-2xl font-bold text-satelink-success"><%= revenueToday %></div>
    </div>
    <div class="bg-white rounded-2xl border border-satelink-border shadow-sm p-5">
        <div class="text-xs font-semibold text-satelink-muted uppercase tracking-wider mb-2">Total Revenue</div>
        <div class="text-2xl font-bold text-gray-900"><%= revenueTotal %></div>
    </div>
    <div class="bg-white rounded-2xl border border-satelink-border shadow-sm p-5">
        <div class="text-xs font-semibold text-satelink-muted uppercase tracking-wider mb-2">Nodes Online</div>
        <div class="text-2xl font-bold text-satelink-accent"><%= nodesOnline %></div>
    </div>
    <div class="bg-white rounded-2xl border border-satelink-border shadow-sm p-5">
        <div class="text-xs font-semibold text-satelink-muted uppercase tracking-wider mb-2">Webhooks</div>
        <div class="text-2xl font-bold text-gray-900">
            <span class="text-emerald-600"><%= webhookSuccess %></span>
            <span class="text-lg text-satelink-muted mx-1">/</span>
            <span class="text-red-500"><%= webhookFail %></span>
        </div>
        <div class="text-xs text-satelink-muted mt-1">success / fail</div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- System Health -->
    <div class="bg-white rounded-2xl border border-satelink-border shadow-sm">
        <div class="p-5 border-b border-satelink-border bg-gray-50/50">
            <h3 class="font-bold text-gray-900">System Health</h3>
        </div>
        <div class="p-5">
            <% if (status && status.ok) { %>
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <span class="text-sm text-gray-600">Engine Status</span>
                    <span class="text-sm font-semibold text-emerald-600">Operational</span>
                </div>
                <% if (status.epoch) { %>
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <span class="text-sm text-gray-600">Current Epoch</span>
                    <span class="text-sm font-semibold text-gray-900">#<%= status.epoch.id || 'N/A' %></span>
                </div>
                <% } %>
                <% if (status.settlement) { %>
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <span class="text-sm text-gray-600">Settlement Mode</span>
                    <span class="text-sm font-bold px-2 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"><%= status.settlement.mode || 'NORMAL' %></span>
                </div>
                <% } %>
                <% if (status.safeMode !== undefined) { %>
                <div class="flex items-center justify-between py-2">
                    <span class="text-sm text-gray-600">Safe Mode</span>
                    <% if (status.safeMode) { %>
                        <span class="text-sm font-bold px-2 py-0.5 rounded bg-amber-50 text-amber-700 border border-amber-200">ACTIVE</span>
                    <% } else { %>
                        <span class="text-sm text-gray-500">Off</span>
                    <% } %>
                </div>
                <% } %>
            <% } else { %>
                <div class="text-sm text-satelink-muted italic py-4 text-center">Status unavailable</div>
            <% } %>
        </div>
    </div>

    <!-- Recent Webhooks -->
    <div class="bg-white rounded-2xl border border-satelink-border shadow-sm">
        <div class="p-5 border-b border-satelink-border bg-gray-50/50 flex justify-between items-center">
            <h3 class="font-bold text-gray-900">Recent Webhooks</h3>
            <span class="text-xs text-satelink-muted"><%= recentWebhooks.length %> events</span>
        </div>
        <div class="divide-y divide-gray-100">
            <% if (recentWebhooks.length === 0) { %>
                <div class="px-5 py-8 text-center text-satelink-muted italic text-sm">No recent webhooks.</div>
            <% } else { %>
                <% recentWebhooks.forEach(function(w) { %>
                    <div class="px-5 py-3 flex items-center justify-between">
                        <div>
                            <div class="text-sm font-medium text-gray-900"><%= w.event_type || w.type || 'event' %></div>
                            <div class="text-xs text-satelink-muted font-mono"><%= w.source || w.wallet || '' %></div>
                        </div>
                        <% if (w.status === 'applied') { %>
                            <span class="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded border border-emerald-200">OK</span>
                        <% } else { %>
                            <span class="text-xs font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded border border-red-200">FAIL</span>
                        <% } %>
                    </div>
                <% }); %>
            <% } %>
        </div>
    </div>
</div>

<!-- Recent Errors -->
<div class="bg-white rounded-2xl border border-satelink-border shadow-sm">
    <div class="p-5 border-b border-satelink-border bg-gray-50/50 flex justify-between items-center">
        <h3 class="font-bold text-gray-900">Recent Errors</h3>
        <a href="/ui/admin/logs" class="text-xs text-satelink-accent hover:underline font-medium">View all logs â†’</a>
    </div>
    <div class="divide-y divide-gray-100">
        <% if (recentErrors.length === 0) { %>
            <div class="px-5 py-8 text-center text-satelink-muted italic text-sm">
                System healthy. No recent errors.
            </div>
        <% } else { %>
            <% recentErrors.forEach(function(e) { %>
                <div class="px-5 py-3">
                    <div class="flex items-start justify-between">
                        <span class="text-sm font-mono text-red-700 break-all"><%= e.message || JSON.stringify(e) %></span>
                        <span class="text-xs text-satelink-muted ml-4 whitespace-nowrap flex-shrink-0"><%= e.ts %></span>
                    </div>
                </div>
            <% }); %>
        <% } %>
    </div>
</div>

<!-- Quick Links -->
<div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-3">
    <a href="/ui/admin/nodes" class="flex items-center justify-center py-3 px-4 bg-white border border-satelink-border rounded-xl text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:border-satelink-accent transition-colors shadow-sm">
        Node Registry
    </a>
    <a href="/ui/admin/ledger" class="flex items-center justify-center py-3 px-4 bg-white border border-satelink-border rounded-xl text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:border-satelink-accent transition-colors shadow-sm">
        Ledger
    </a>
    <a href="/ui/admin/withdrawals" class="flex items-center justify-center py-3 px-4 bg-white border border-satelink-border rounded-xl text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:border-satelink-accent transition-colors shadow-sm">
        Withdrawals
    </a>
    <a href="/agent-control-centre.html" class="flex items-center justify-center py-3 px-4 bg-white border border-satelink-border rounded-xl text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:border-satelink-accent transition-colors shadow-sm">
        Agent Control
    </a>
</div>

<%- include('partials/footer') %>
